openapi: 3.0.0
info:
  title: Canvus API
  version: 1.2.0
  description: |
    The Canvus API provides programmatic access to manage canvases, widgets, users, and system
    resources on a Canvus Server. This specification documents all endpoints available through
    the Canvus Go SDK.

    ## Authentication

    All API requests require authentication using one of the following methods:

    - **API Key**: Pass your API key in the `Private-Token` header
    - **Session Token**: After login, use the returned token in the `Private-Token` header

    ## Base URL

    The API base URL follows the format: `https://{server}/api/v1/`

    ## Rate Limiting

    The API implements rate limiting. When rate limited, requests return HTTP 429.
    The SDK includes automatic retry with exponential backoff.

    ## Error Handling

    Errors are returned as JSON objects with `code` and `message` fields.
    HTTP status codes indicate the error category (4xx for client errors, 5xx for server errors).
  contact:
    name: Canvus SDK Support
    url: https://github.com/jaypaulb/Canvus-Go-API
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: https://{server}/api/v1
    description: Canvus Server API
    variables:
      server:
        default: localhost
        description: Canvus server hostname or IP address

tags:
  - name: Authentication
    description: User authentication and session management
  - name: Users
    description: User management operations
  - name: Access Tokens
    description: API access token management
  - name: Groups
    description: User group management
  - name: Canvases
    description: Canvas management operations
  - name: Canvas Background
    description: Canvas background settings
  - name: Canvas Permissions
    description: Canvas permission management
  - name: Color Presets
    description: Canvas color preset management
  - name: Folders
    description: Canvas folder management
  - name: Widgets
    description: Generic widget operations
  - name: Notes
    description: Note widget operations
  - name: Images
    description: Image widget operations
  - name: PDFs
    description: PDF widget operations
  - name: Videos
    description: Video widget operations
  - name: Anchors
    description: Anchor widget operations
  - name: Browsers
    description: Browser widget operations
  - name: Connectors
    description: Connector widget operations
  - name: Clients
    description: Client device management
  - name: Workspaces
    description: Client workspace management
  - name: Video I/O
    description: Video input/output management
  - name: System
    description: System information and configuration
  - name: Audit Log
    description: Audit log access
  - name: Assets
    description: Asset and mipmap management

security:
  - ApiKeyAuth: []

paths:
  # Authentication
  /users/login:
    post:
      tags:
        - Authentication
      summary: Login with email and password
      description: Authenticates a user and returns a session token for subsequent API requests.
      operationId: login
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LoginRequest'
            example:
              email: user@example.com
              password: secretpassword
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LoginResponse'
              example:
                token: eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...
                user:
                  id: 123
        '401':
          $ref: '#/components/responses/Unauthorized'
        '400':
          $ref: '#/components/responses/BadRequest'

  /users/logout:
    post:
      tags:
        - Authentication
      summary: Logout and invalidate token
      description: Invalidates the current session token.
      operationId: logout
      responses:
        '200':
          description: Logout successful
        '401':
          $ref: '#/components/responses/Unauthorized'

  # Users
  /users:
    get:
      tags:
        - Users
      summary: List all users
      description: Retrieves a list of all users in the system.
      operationId: listUsers
      responses:
        '200':
          description: List of users
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/User'
              example:
                - id: 1
                  name: Admin User
                  email: admin@example.com
                  admin: true
                  approved: true
                  blocked: false
                  created_at: "2024-01-01T00:00:00Z"
                  last_login: "2024-01-15T10:30:00Z"
                  state: active
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Users
      summary: Create a new user
      description: Creates a new user account.
      operationId: createUser
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateUserRequest'
            example:
              email: newuser@example.com
              name: New User
              password: securepassword123
              admin: false
              approved: true
      responses:
        '201':
          description: User created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '409':
          description: User already exists

  /users/{userId}:
    get:
      tags:
        - Users
      summary: Get user by ID
      description: Retrieves a specific user by their ID.
      operationId: getUser
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '200':
          description: User details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Users
      summary: Update user
      description: Updates an existing user's information.
      operationId: updateUser
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateUserRequest'
            example:
              name: Updated Name
              admin: true
      responses:
        '200':
          description: User updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/User'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Users
      summary: Delete user
      description: Permanently deletes a user.
      operationId: deleteUser
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '200':
          description: User deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Access Tokens
  /users/{userId}/access-tokens:
    get:
      tags:
        - Access Tokens
      summary: List user access tokens
      description: Retrieves all API access tokens for a user.
      operationId: listAccessTokens
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      responses:
        '200':
          description: List of access tokens
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AccessToken'
              example:
                - id: "abc123"
                  description: "CLI Token"
                  created_at: "2024-01-01T00:00:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Access Tokens
      summary: Create access token
      description: Creates a new API access token for a user.
      operationId: createAccessToken
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAccessTokenRequest'
            example:
              description: "Automation Token"
      responses:
        '201':
          description: Token created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessToken'
              example:
                id: "def456"
                description: "Automation Token"
                created_at: "2024-01-15T10:00:00Z"
                plain_token: "glpat-xxxxxxxxxxxxxxxxxxxx"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /users/{userId}/access-tokens/{tokenId}:
    get:
      tags:
        - Access Tokens
      summary: Get access token
      description: Retrieves a specific access token by ID.
      operationId: getAccessToken
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
        - $ref: '#/components/parameters/TokenIdPath'
      responses:
        '200':
          description: Access token details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/AccessToken'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Access Tokens
      summary: Delete access token
      description: Revokes and deletes an access token.
      operationId: deleteAccessToken
      parameters:
        - $ref: '#/components/parameters/UserIdPath'
        - $ref: '#/components/parameters/TokenIdPath'
      responses:
        '200':
          description: Token deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Groups
  /groups:
    get:
      tags:
        - Groups
      summary: List all groups
      description: Retrieves all user groups.
      operationId: listGroups
      responses:
        '200':
          description: List of groups
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Group'
              example:
                - id: 1
                  name: Administrators
                  description: System administrators
                - id: 2
                  name: Editors
                  description: Content editors
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Groups
      summary: Create group
      description: Creates a new user group.
      operationId: createGroup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateGroupRequest'
            example:
              name: New Team
              description: A new team group
      responses:
        '201':
          description: Group created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /groups/{groupId}:
    get:
      tags:
        - Groups
      summary: Get group by ID
      description: Retrieves a specific group.
      operationId: getGroup
      parameters:
        - $ref: '#/components/parameters/GroupIdPath'
      responses:
        '200':
          description: Group details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Group'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Groups
      summary: Delete group
      description: Deletes a user group.
      operationId: deleteGroup
      parameters:
        - $ref: '#/components/parameters/GroupIdPath'
      responses:
        '200':
          description: Group deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /groups/{groupId}/members:
    get:
      tags:
        - Groups
      summary: List group members
      description: Lists all users in a group.
      operationId: listGroupMembers
      parameters:
        - $ref: '#/components/parameters/GroupIdPath'
      responses:
        '200':
          description: List of group members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/GroupMember'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Groups
      summary: Add user to group
      description: Adds a user to a group.
      operationId: addUserToGroup
      parameters:
        - $ref: '#/components/parameters/GroupIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AddUserToGroupRequest'
            example:
              id: 123
      responses:
        '200':
          description: User added to group
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /groups/{groupId}/members/{userId}:
    delete:
      tags:
        - Groups
      summary: Remove user from group
      description: Removes a user from a group.
      operationId: removeUserFromGroup
      parameters:
        - $ref: '#/components/parameters/GroupIdPath'
        - name: userId
          in: path
          required: true
          schema:
            type: integer
            format: int64
      responses:
        '200':
          description: User removed from group
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Canvases
  /canvases:
    get:
      tags:
        - Canvases
      summary: List all canvases
      description: Retrieves all canvases accessible to the authenticated user.
      operationId: listCanvases
      responses:
        '200':
          description: List of canvases
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Canvas'
              example:
                - id: "canvas-123"
                  name: Project Canvas
                  access: owner
                  asset_size: 1024000
                  created_at: "2024-01-01T00:00:00Z"
                  folder_id: "folder-1"
                  in_trash: false
                  mode: normal
                  modified_at: "2024-01-15T10:00:00Z"
                  preview_hash: "abc123"
                  state: active
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Canvases
      summary: Create canvas
      description: Creates a new canvas.
      operationId: createCanvas
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateCanvasRequest'
            example:
              name: New Canvas
              folder_id: "folder-1"
      responses:
        '201':
          description: Canvas created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Canvas'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /canvases/{canvasId}:
    get:
      tags:
        - Canvases
      summary: Get canvas by ID
      description: Retrieves a specific canvas.
      operationId: getCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Canvas details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Canvas'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Canvases
      summary: Update canvas
      description: Updates canvas properties (name, mode).
      operationId: updateCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateCanvasRequest'
            example:
              name: Renamed Canvas
              mode: demo
      responses:
        '200':
          description: Canvas updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Canvas'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Canvases
      summary: Delete canvas
      description: Permanently deletes a canvas.
      operationId: deleteCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Canvas deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/preview:
    get:
      tags:
        - Canvases
      summary: Get canvas preview
      description: Downloads the preview image of a canvas.
      operationId: getCanvasPreview
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Canvas preview image
          content:
            image/png:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/move:
    post:
      tags:
        - Canvases
      summary: Move canvas
      description: Moves a canvas to another folder.
      operationId: moveCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveOrCopyCanvasRequest'
            example:
              folder_id: "folder-2"
              conflicts: rename
      responses:
        '200':
          description: Canvas moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Canvas'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/copy:
    post:
      tags:
        - Canvases
      summary: Copy canvas
      description: Creates a copy of a canvas in the specified folder.
      operationId: copyCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveOrCopyCanvasRequest'
            example:
              folder_id: "folder-2"
      responses:
        '201':
          description: Canvas copied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Canvas'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/restore:
    post:
      tags:
        - Canvases
      summary: Restore demo canvas
      description: Restores a demo canvas to its last saved state.
      operationId: restoreDemoCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Demo canvas restored
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/save:
    post:
      tags:
        - Canvases
      summary: Save demo state
      description: Saves the current state of a demo canvas.
      operationId: saveDemoState
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Demo state saved
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Canvas Background
  /canvases/{canvasId}/background:
    get:
      tags:
        - Canvas Background
      summary: Get canvas background
      description: Retrieves the background settings for a canvas.
      operationId: getCanvasBackground
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Background settings
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CanvasBackground'
              example:
                type: solid
                background_color: "#1a1a2e"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Canvas Background
      summary: Update canvas background
      description: Sets the background to solid color or haze.
      operationId: patchCanvasBackground
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CanvasBackground'
            example:
              type: haze
              haze:
                color1: "#1a1a2e"
                color2: "#16213e"
                speed: 0.5
                scale: 1.0
      responses:
        '200':
          description: Background updated
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Canvas Background
      summary: Set background image
      description: Sets the background to an image (multipart upload).
      operationId: postCanvasBackground
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                json:
                  type: string
                  description: JSON metadata
                data:
                  type: string
                  format: binary
                  description: Image file
      responses:
        '200':
          description: Background image set
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Canvas Permissions
  /canvases/{canvasId}/permissions:
    get:
      tags:
        - Canvas Permissions
      summary: Get canvas permissions
      description: Gets permission overrides on a canvas.
      operationId: getCanvasPermissions
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: Canvas permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CanvasPermissions'
              example:
                editors_can_share: true
                users:
                  - id: 1
                    permission: editor
                    inherited: false
                groups:
                  - id: 1
                    permission: viewer
                    inherited: true
                link_permission: viewer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Canvas Permissions
      summary: Set canvas permissions
      description: Sets permission overrides on a canvas.
      operationId: setCanvasPermissions
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CanvasPermissions'
      responses:
        '200':
          description: Permissions updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CanvasPermissions'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Color Presets
  /canvases/{canvasId}/colorpresets:
    get:
      tags:
        - Color Presets
      summary: List color presets
      description: Lists all color presets for a canvas.
      operationId: listColorPresets
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of color presets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ColorPreset'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Color Presets
      summary: Create color preset
      description: Creates a new color preset.
      operationId: createColorPreset
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Color preset created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ColorPreset'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/colorpresets/{name}:
    get:
      tags:
        - Color Presets
      summary: Get color preset
      description: Gets a color preset by name.
      operationId: getColorPreset
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Color preset details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ColorPreset'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Color Presets
      summary: Update color preset
      description: Updates a color preset.
      operationId: updateColorPreset
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: name
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Color preset updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ColorPreset'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Color Presets
      summary: Delete color preset
      description: Deletes a color preset.
      operationId: deleteColorPreset
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: name
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Color preset deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Folders
  /canvas-folders:
    get:
      tags:
        - Folders
      summary: List all folders
      description: Lists all canvas folders.
      operationId: listFolders
      responses:
        '200':
          description: List of folders
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Folder'
              example:
                - id: "folder-1"
                  name: Projects
                  folder_id: ""
                  access: owner
                  in_trash: false
                  state: active
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Folders
      summary: Create folder
      description: Creates a new canvas folder.
      operationId: createFolder
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateFolderRequest'
            example:
              name: New Folder
              folder_id: "parent-folder-id"
      responses:
        '201':
          description: Folder created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /canvas-folders/{folderId}:
    get:
      tags:
        - Folders
      summary: Get folder by ID
      description: Retrieves a specific folder.
      operationId: getFolder
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      responses:
        '200':
          description: Folder details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Folders
      summary: Rename folder
      description: Renames a folder.
      operationId: renameFolder
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/RenameFolderRequest'
            example:
              name: Renamed Folder
      responses:
        '200':
          description: Folder renamed
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Folders
      summary: Delete folder
      description: Permanently deletes a folder.
      operationId: deleteFolder
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      responses:
        '200':
          description: Folder deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvas-folders/{folderId}/move:
    post:
      tags:
        - Folders
      summary: Move folder
      description: Moves a folder to another parent folder.
      operationId: moveFolder
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveOrCopyFolderRequest'
      responses:
        '200':
          description: Folder moved
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvas-folders/{folderId}/copy:
    post:
      tags:
        - Folders
      summary: Copy folder
      description: Copies a folder to another parent folder.
      operationId: copyFolder
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/MoveOrCopyFolderRequest'
      responses:
        '201':
          description: Folder copied
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Folder'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvas-folders/{folderId}/children:
    delete:
      tags:
        - Folders
      summary: Delete folder contents
      description: Deletes all children of a folder.
      operationId: deleteFolderContents
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      responses:
        '200':
          description: Folder contents deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvas-folders/{folderId}/permissions:
    get:
      tags:
        - Folders
      summary: Get folder permissions
      description: Gets permission overrides on a folder.
      operationId: getFolderPermissions
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      responses:
        '200':
          description: Folder permissions
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FolderPermissions'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Folders
      summary: Set folder permissions
      description: Sets permission overrides on a folder.
      operationId: setFolderPermissions
      parameters:
        - $ref: '#/components/parameters/FolderIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/FolderPermissions'
      responses:
        '200':
          description: Permissions updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/FolderPermissions'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Widgets (Generic)
  /canvases/{canvasId}/widgets:
    get:
      tags:
        - Widgets
      summary: List all widgets
      description: Lists all widgets on a canvas.
      operationId: listWidgets
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of widgets
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Widget'
              example:
                - id: "widget-1"
                  widget_type: note
                  parent_id: ""
                  location:
                    x: 100
                    y: 200
                  size:
                    width: 300
                    height: 200
                  pinned: false
                  scale: 1.0
                  state: active
                  depth: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/widgets/{widgetId}:
    get:
      tags:
        - Widgets
      summary: Get widget by ID
      description: Retrieves a specific widget.
      operationId: getWidget
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - $ref: '#/components/parameters/WidgetIdPath'
      responses:
        '200':
          description: Widget details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Widget'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Widgets
      summary: Update widget parent
      description: Updates the parent ID of a widget (parenting).
      operationId: patchParentId
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - $ref: '#/components/parameters/WidgetIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                parent_id:
                  type: string
            example:
              parent_id: "parent-widget-id"
      responses:
        '200':
          description: Widget updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Widget'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /widgets/{widgetId}/move:
    post:
      tags:
        - Widgets
      summary: Move widget to canvas
      description: Moves a widget to another canvas.
      operationId: moveWidget
      parameters:
        - $ref: '#/components/parameters/WidgetIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                canvas_id:
                  type: string
            example:
              canvas_id: "target-canvas-id"
      responses:
        '200':
          description: Widget moved
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /widgets/{widgetId}/copy:
    post:
      tags:
        - Widgets
      summary: Copy widget to canvas
      description: Copies a widget to another canvas.
      operationId: copyWidget
      parameters:
        - $ref: '#/components/parameters/WidgetIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                canvas_id:
                  type: string
      responses:
        '200':
          description: Widget copied
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /widgets/{widgetId}/pin:
    post:
      tags:
        - Widgets
      summary: Pin widget
      description: Pins a widget in place.
      operationId: pinWidget
      parameters:
        - $ref: '#/components/parameters/WidgetIdPath'
      responses:
        '200':
          description: Widget pinned
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /widgets/{widgetId}/unpin:
    post:
      tags:
        - Widgets
      summary: Unpin widget
      description: Unpins a widget.
      operationId: unpinWidget
      parameters:
        - $ref: '#/components/parameters/WidgetIdPath'
      responses:
        '200':
          description: Widget unpinned
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Notes
  /canvases/{canvasId}/notes:
    get:
      tags:
        - Notes
      summary: List all notes
      description: Lists all note widgets on a canvas.
      operationId: listNotes
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of notes
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Note'
              example:
                - id: "note-1"
                  widget_type: note
                  text: Hello World
                  title: My Note
                  background_color: "#ffeb3b"
                  parent_id: ""
                  pinned: false
                  scale: 1.0
                  state: active
                  depth: 0
                  location:
                    x: 100
                    y: 200
                  size:
                    width: 300
                    height: 200
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Notes
      summary: Create note
      description: Creates a new note widget.
      operationId: createNote
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateNoteRequest'
            example:
              widget_type: note
              text: This is a note
              title: My Note
              background_color: "#ffeb3b"
              location:
                x: 100
                y: 200
              size:
                width: 300
                height: 200
      responses:
        '201':
          description: Note created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Note'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/notes/{noteId}:
    get:
      tags:
        - Notes
      summary: Get note by ID
      description: Retrieves a specific note widget.
      operationId: getNote
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: noteId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Note details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Note'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Notes
      summary: Update note
      description: Updates a note widget.
      operationId: updateNote
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: noteId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
            example:
              text: Updated text
              background_color: "#4caf50"
      responses:
        '200':
          description: Note updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Note'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Notes
      summary: Delete note
      description: Deletes a note widget.
      operationId: deleteNote
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: noteId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Note deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Images
  /canvases/{canvasId}/images:
    get:
      tags:
        - Images
      summary: List all images
      description: Lists all image widgets on a canvas.
      operationId: listImages
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of images
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Image'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Images
      summary: Create image
      description: Creates a new image widget (multipart upload).
      operationId: createImage
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                json:
                  type: string
                  description: JSON metadata for the image
                data:
                  type: string
                  format: binary
                  description: Image file
      responses:
        '201':
          description: Image created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/images/{imageId}:
    get:
      tags:
        - Images
      summary: Get image by ID
      description: Retrieves image widget metadata.
      operationId: getImage
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: imageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Image details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Images
      summary: Update image
      description: Updates image widget properties.
      operationId: updateImage
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: imageId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Image updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Image'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Images
      summary: Delete image
      description: Deletes an image widget.
      operationId: deleteImage
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: imageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Image deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/images/{imageId}/download:
    get:
      tags:
        - Images
      summary: Download image file
      description: Downloads the image file data.
      operationId: downloadImage
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: imageId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Image file data
          content:
            image/*:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # PDFs
  /canvases/{canvasId}/pdfs:
    get:
      tags:
        - PDFs
      summary: List all PDFs
      description: Lists all PDF widgets on a canvas.
      operationId: listPDFs
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of PDFs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/PDF'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - PDFs
      summary: Create PDF
      description: Creates a new PDF widget (multipart upload).
      operationId: createPDF
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                json:
                  type: string
                  description: JSON metadata
                data:
                  type: string
                  format: binary
                  description: PDF file
      responses:
        '201':
          description: PDF created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PDF'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/pdfs/{pdfId}:
    get:
      tags:
        - PDFs
      summary: Get PDF by ID
      description: Retrieves PDF widget metadata.
      operationId: getPDF
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: pdfId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PDF'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - PDFs
      summary: Update PDF
      description: Updates PDF widget properties.
      operationId: updatePDF
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: pdfId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: PDF updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/PDF'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - PDFs
      summary: Delete PDF
      description: Deletes a PDF widget.
      operationId: deletePDF
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: pdfId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/pdfs/{pdfId}/download:
    get:
      tags:
        - PDFs
      summary: Download PDF file
      description: Downloads the PDF file data.
      operationId: downloadPDF
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: pdfId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: PDF file data
          content:
            application/pdf:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Videos
  /canvases/{canvasId}/videos:
    get:
      tags:
        - Videos
      summary: List all videos
      description: Lists all video widgets on a canvas.
      operationId: listVideos
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of videos
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Video'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Videos
      summary: Create video
      description: Creates a new video widget (multipart upload).
      operationId: createVideo
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                json:
                  type: string
                  description: JSON metadata
                data:
                  type: string
                  format: binary
                  description: Video file
      responses:
        '201':
          description: Video created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Video'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/videos/{videoId}:
    get:
      tags:
        - Videos
      summary: Get video by ID
      description: Retrieves video widget metadata.
      operationId: getVideo
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Video'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Videos
      summary: Update video
      description: Updates video widget properties.
      operationId: updateVideo
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Video updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Video'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Videos
      summary: Delete video
      description: Deletes a video widget.
      operationId: deleteVideo
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/videos/{videoId}/download:
    get:
      tags:
        - Videos
      summary: Download video file
      description: Downloads the video file data.
      operationId: downloadVideo
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: videoId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video file data
          content:
            video/*:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Upload
  /canvases/{canvasId}/uploads-folder:
    post:
      tags:
        - Assets
      summary: Upload note or asset
      description: Uploads a note or asset file to the canvas uploads folder. Accepts multipart/form-data with a 'json' part for notes or a 'data' part (with optional 'json' part) for assets.
      operationId: uploadToCanvas
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                json:
                  type: string
                  description: JSON metadata for the note or asset
                data:
                  type: string
                  format: binary
                  description: Binary file data for assets (images, PDFs, videos)
      responses:
        '201':
          description: Note or asset uploaded successfully
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: '#/components/schemas/Note'
                  - $ref: '#/components/schemas/Asset'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Anchors
  /canvases/{canvasId}/anchors:
    get:
      tags:
        - Anchors
      summary: List all anchors
      description: Lists all anchor widgets on a canvas.
      operationId: listAnchors
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of anchors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Anchor'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Anchors
      summary: Create anchor
      description: Creates a new anchor widget.
      operationId: createAnchor
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateAnchorRequest'
            example:
              widget_type: anchor
              anchor_name: "Section 1"
              anchor_index: 1
              location:
                x: 0
                y: 0
              size:
                width: 1000
                height: 1000
      responses:
        '201':
          description: Anchor created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Anchor'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/anchors/{anchorId}:
    get:
      tags:
        - Anchors
      summary: Get anchor by ID
      description: Retrieves a specific anchor widget.
      operationId: getAnchor
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: anchorId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Anchor details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Anchor'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Anchors
      summary: Update anchor
      description: Updates an anchor widget.
      operationId: updateAnchor
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: anchorId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Anchor updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Anchor'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Anchors
      summary: Delete anchor
      description: Deletes an anchor widget.
      operationId: deleteAnchor
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: anchorId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Anchor deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Browsers
  /canvases/{canvasId}/browsers:
    get:
      tags:
        - Browsers
      summary: List browsers
      description: Lists all browser widgets on a canvas.
      operationId: listBrowsers
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of browsers
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Browser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Browsers
      summary: Create browser
      description: Creates a new browser widget on a canvas.
      operationId: createBrowser
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - url
                - location
                - size
              properties:
                url:
                  type: string
                  description: The URL to load in the browser
                location:
                  $ref: '#/components/schemas/Point'
                size:
                  $ref: '#/components/schemas/Size'
                title:
                  type: string
                  description: Browser window title
                scale:
                  type: number
                  format: double
                  description: Browser zoom scale
                transparent_mode:
                  type: boolean
                  description: Whether to use transparent mode
      responses:
        '201':
          description: Browser created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Browser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/browsers/{browserId}:
    get:
      tags:
        - Browsers
      summary: Get browser by ID
      description: Retrieves a specific browser widget.
      operationId: getBrowser
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: browserId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Browser details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Browser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Browsers
      summary: Update browser
      description: Updates a browser widget.
      operationId: updateBrowser
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: browserId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                url:
                  type: string
                  description: The URL to load in the browser
                location:
                  $ref: '#/components/schemas/Point'
                size:
                  $ref: '#/components/schemas/Size'
                title:
                  type: string
                  description: Browser window title
                scale:
                  type: number
                  format: double
                  description: Browser zoom scale
                transparent_mode:
                  type: boolean
                  description: Whether to use transparent mode
                main_frame_scroll_offset:
                  $ref: '#/components/schemas/Point'
      responses:
        '200':
          description: Browser updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Browser'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Browsers
      summary: Delete browser
      description: Deletes a browser widget.
      operationId: deleteBrowser
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: browserId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Browser deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Connectors
  /canvases/{canvasId}/connectors:
    get:
      tags:
        - Connectors
      summary: List all connectors
      description: Lists all connector widgets on a canvas.
      operationId: listConnectors
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of connectors
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Connector'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Connectors
      summary: Create connector
      description: Creates a new connector widget linking two widgets.
      operationId: createConnector
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateConnectorRequest'
            example:
              widget_type: connector
              src:
                id: "widget-1"
              dst:
                id: "widget-2"
              line_color: "#000000"
              line_width: 2
              type: straight
      responses:
        '201':
          description: Connector created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/connectors/{connectorId}:
    get:
      tags:
        - Connectors
      summary: Get connector by ID
      description: Retrieves a specific connector widget.
      operationId: getConnector
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: connectorId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Connector details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Connectors
      summary: Update connector
      description: Updates a connector widget.
      operationId: updateConnector
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: connectorId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Connector updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Connector'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Connectors
      summary: Delete connector
      description: Deletes a connector widget.
      operationId: deleteConnector
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: connectorId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Connector deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Video Inputs
  /canvases/{canvasId}/video-inputs:
    get:
      tags:
        - Video I/O
      summary: List canvas video inputs
      description: Lists all video input widgets on a canvas.
      operationId: listVideoInputs
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      responses:
        '200':
          description: List of video inputs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VideoInput'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    post:
      tags:
        - Video I/O
      summary: Create video input
      description: Creates a new video input widget.
      operationId: createVideoInput
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Video input created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoInput'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/video-inputs/{inputId}:
    delete:
      tags:
        - Video I/O
      summary: Delete video input
      description: Deletes a video input widget.
      operationId: deleteVideoInput
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: inputId
          in: path
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Video input deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /canvases/{canvasId}/video-outputs/{outputId}:
    patch:
      tags:
        - Video I/O
      summary: Update video output
      description: Updates a video output on a canvas.
      operationId: updateVideoOutput
      parameters:
        - $ref: '#/components/parameters/CanvasIdPath'
        - name: outputId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Video output updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/VideoOutput'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # Clients
  /clients:
    get:
      tags:
        - Clients
      summary: List all clients
      description: Lists all client devices.
      operationId: listClients
      responses:
        '200':
          description: List of clients
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ClientInfo'
              example:
                - id: "client-1"
                  name: Meeting Room Display
                  user_id: "123"
                  created_at: "2024-01-01T00:00:00Z"
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - Clients
      summary: Create client
      description: Creates a new client device.
      operationId: createClient
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CreateClientRequest'
      responses:
        '201':
          description: Client created
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'

  /clients/{clientId}:
    get:
      tags:
        - Clients
      summary: Get client by ID
      description: Retrieves a specific client device.
      operationId: getClient
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
      responses:
        '200':
          description: Client details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Clients
      summary: Update client
      description: Updates a client device.
      operationId: updateClient
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateClientRequest'
      responses:
        '200':
          description: Client updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ClientInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    delete:
      tags:
        - Clients
      summary: Delete client
      description: Deletes a client device.
      operationId: deleteClient
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
      responses:
        '200':
          description: Client deleted
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /clients/{clientId}/workspaces:
    get:
      tags:
        - Workspaces
      summary: List workspaces
      description: Lists all workspaces for a client device.
      operationId: listWorkspaces
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
      responses:
        '200':
          description: List of workspaces
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/Workspace'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /clients/{clientId}/workspaces/{workspaceIndex}:
    get:
      tags:
        - Workspaces
      summary: Get workspace
      description: Retrieves a specific workspace by index.
      operationId: getWorkspace
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
        - name: workspaceIndex
          in: path
          required: true
          description: The workspace index (0-based)
          schema:
            type: integer
            minimum: 0
      responses:
        '200':
          description: Workspace details
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

    patch:
      tags:
        - Workspaces
      summary: Update workspace
      description: Updates workspace parameters such as pinned state, info panel visibility, or viewport.
      operationId: updateWorkspace
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
        - name: workspaceIndex
          in: path
          required: true
          description: The workspace index (0-based)
          schema:
            type: integer
            minimum: 0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/UpdateWorkspaceRequest'
      responses:
        '200':
          description: Workspace updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Workspace'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /clients/{clientId}/workspaces/{workspaceIndex}/open-canvas:
    post:
      tags:
        - Workspaces
      summary: Open canvas on workspace
      description: Opens a canvas on the specified workspace. Optionally centers the viewport on specified coordinates or widget.
      operationId: openCanvasOnWorkspace
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
        - name: workspaceIndex
          in: path
          required: true
          description: The workspace index (0-based)
          schema:
            type: integer
            minimum: 0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OpenCanvasRequest'
      responses:
        '200':
          description: Canvas opened successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /clients/{clientId}/video-inputs:
    get:
      tags:
        - Video I/O
      summary: List client video inputs
      description: Lists all video input sources for a client device.
      operationId: listClientVideoInputs
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
      responses:
        '200':
          description: List of video input sources
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VideoInputSource'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /clients/{clientId}/video-outputs:
    get:
      tags:
        - Video I/O
      summary: List client video outputs
      description: Lists all video outputs for a client device.
      operationId: listVideoOutputs
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
      responses:
        '200':
          description: List of video outputs
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/VideoOutput'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /clients/{clientId}/video-outputs/{index}:
    patch:
      tags:
        - Video I/O
      summary: Set video output source
      description: Sets the source or suspends a video output.
      operationId: setVideoOutputSource
      parameters:
        - $ref: '#/components/parameters/ClientIdPath'
        - name: index
          in: path
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: Video output updated
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  # System
  /server-info:
    get:
      tags:
        - System
      summary: Get server info
      description: Retrieves information about the Canvus Server instance.
      operationId: getServerInfo
      responses:
        '200':
          description: Server information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerInfo'
              example:
                api:
                  - "v1"
                go: "1.21"
                server_id: "server-abc123"
                version: "1.2.3"
        '401':
          $ref: '#/components/responses/Unauthorized'

  /license:
    get:
      tags:
        - System
      summary: Get license info
      description: Retrieves the current license information.
      operationId: getLicenseInfo
      responses:
        '200':
          description: License information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/LicenseInfo'
              example:
                valid: true
                expires_at: "2025-12-31T23:59:59Z"
                type: enterprise
                seats: 100
                issued_to: "ACME Corp"
                features:
                  - "api_access"
                  - "sso"
        '401':
          $ref: '#/components/responses/Unauthorized'

    post:
      tags:
        - System
      summary: Install license
      description: Installs a new license key on the server.
      operationId: installLicense
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - key
              properties:
                key:
                  type: string
                  description: License key to install
            example:
              key: "XXXX-XXXX-XXXX-XXXX"
      responses:
        '200':
          description: License installed successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - requires admin privileges

  /license/request:
    get:
      tags:
        - System
      summary: Get offline activation request
      description: Retrieves the offline activation request token for license activation.
      operationId: getActivationRequest
      responses:
        '200':
          description: Activation request token
          content:
            application/json:
              schema:
                type: object
                properties:
                  request:
                    type: string
                    description: Offline activation request token
              example:
                request: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - requires admin privileges

  /license/activate:
    post:
      tags:
        - System
      summary: Activate license offline
      description: Activates the license using an offline activation key.
      operationId: activateLicense
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - key
              properties:
                key:
                  type: string
                  description: Offline activation key
            example:
              key: "ACTIVATION-KEY-XXXX-XXXX"
      responses:
        '200':
          description: License activated successfully
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - requires admin privileges

  /server-config:
    get:
      tags:
        - System
      summary: Get server config
      description: Retrieves the server configuration.
      operationId: getServerConfig
      responses:
        '200':
          description: Server configuration
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerConfig'
        '401':
          $ref: '#/components/responses/Unauthorized'

    patch:
      tags:
        - System
      summary: Update server config
      description: Updates the server configuration.
      operationId: updateServerConfig
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ServerConfig'
      responses:
        '200':
          description: Configuration updated
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ServerConfig'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - requires admin privileges

  /server-config/send-test-email:
    post:
      tags:
        - System
      summary: Send test email
      description: Sends a test email to the current user.
      operationId: sendTestEmail
      responses:
        '200':
          description: Test email sent
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          description: Email sending failed

  /server-config/reload-certs:
    post:
      tags:
        - System
      summary: Reload TLS certificates
      description: Reloads the server's TLS certificates without restarting the server.
      operationId: reloadCerts
      responses:
        '200':
          description: Certificates reloaded successfully
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - requires admin privileges
        '500':
          description: Certificate reload failed


  # Audit Log
  /audit-log:
    get:
      tags:
        - Audit Log
      summary: List audit events
      description: Retrieves audit log events with optional pagination.
      operationId: listAuditEvents
      parameters:
        - name: per_page
          in: query
          schema:
            type: integer
          description: Number of events per page
      responses:
        '200':
          description: List of audit events
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/AuditEvent'
              example:
                - id: "1"
                  timestamp: "2024-01-15T10:30:00Z"
                  user_id: 123
                  action: login
                  resource: user
                  details: "User logged in successfully"
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          description: Forbidden - requires admin privileges

  # Assets and Mipmaps
  /api/v1/mipmaps/{hash}:
    get:
      tags:
        - Assets
      summary: Get mipmap info
      description: Retrieves mipmap information for an asset.
      operationId: getMipmapInfo
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            type: string
          description: Public hash of the asset
        - name: page
          in: query
          schema:
            type: integer
          description: Page number (for PDFs)
        - name: canvas-id
          in: header
          required: true
          schema:
            type: string
          description: Canvas ID for authorization
      responses:
        '200':
          description: Mipmap information
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/MipmapInfo'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/mipmaps/{hash}/{level}:
    get:
      tags:
        - Assets
      summary: Get mipmap level
      description: Retrieves a specific mipmap level image (WebP format).
      operationId: getMipmapLevel
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            type: string
        - name: level
          in: path
          required: true
          schema:
            type: integer
        - name: page
          in: query
          schema:
            type: integer
        - name: canvas-id
          in: header
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Mipmap image data
          content:
            image/webp:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

  /api/v1/assets/{hash}:
    get:
      tags:
        - Assets
      summary: Get asset by hash
      description: Retrieves an asset file by its hash.
      operationId: getAssetByHash
      parameters:
        - name: hash
          in: path
          required: true
          schema:
            type: string
          description: Public hash of the asset
        - name: canvas-id
          in: header
          required: true
          schema:
            type: string
          description: Canvas ID for authorization
      responses:
        '200':
          description: Asset file data
          content:
            application/octet-stream:
              schema:
                type: string
                format: binary
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'

components:
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: Private-Token
      description: API key for authentication. Obtain from user access tokens.

  parameters:
    UserIdPath:
      name: userId
      in: path
      required: true
      schema:
        type: integer
        format: int64
      description: User ID

    TokenIdPath:
      name: tokenId
      in: path
      required: true
      schema:
        type: string
      description: Access token ID

    GroupIdPath:
      name: groupId
      in: path
      required: true
      schema:
        type: integer
      description: Group ID

    CanvasIdPath:
      name: canvasId
      in: path
      required: true
      schema:
        type: string
      description: Canvas ID

    FolderIdPath:
      name: folderId
      in: path
      required: true
      schema:
        type: string
      description: Folder ID

    WidgetIdPath:
      name: widgetId
      in: path
      required: true
      schema:
        type: string
      description: Widget ID

    ClientIdPath:
      name: clientId
      in: path
      required: true
      schema:
        type: string
      description: Client ID

  responses:
    BadRequest:
      description: Bad request - invalid input
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APIError'
          example:
            code: bad_request
            message: Invalid request body
            request_id: req-xyz789

    Unauthorized:
      description: Unauthorized - invalid or missing authentication
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APIError'
          example:
            code: unauthorized
            message: Invalid or missing API key
            request_id: req-abc123

    NotFound:
      description: Resource not found
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APIError'
          example:
            code: not_found
            message: Resource not found
            request_id: req-def456

    RateLimited:
      description: Too many requests - rate limited
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/APIError'
          example:
            code: rate_limited
            message: Too many requests, please try again later
            request_id: req-ghi789

  schemas:
    APIError:
      type: object
      description: Standard error response returned by the API
      properties:
        code:
          type: string
          description: Machine-readable error code
        message:
          type: string
          description: Human-readable error message
        request_id:
          type: string
          description: Unique request ID for debugging and support
      example:
        code: not_found
        message: Resource not found
        request_id: req-abc123

    LoginRequest:
      type: object
      description: Credentials for user authentication
      required:
        - email
        - password
      properties:
        email:
          type: string
          format: email
          description: User's email address
        password:
          type: string
          description: User's password

    LoginResponse:
      type: object
      description: Response containing authentication token
      properties:
        token:
          type: string
          description: Session token for subsequent API requests
        user:
          type: object
          properties:
            id:
              type: integer
              format: int64
              description: User's unique identifier

    User:
      type: object
      description: User account in the Canvus system
      properties:
        id:
          type: integer
          format: int64
          description: Unique user identifier
        name:
          type: string
          description: User's display name
        email:
          type: string
          format: email
          description: User's email address
        admin:
          type: boolean
          description: Whether the user has administrator privileges
        approved:
          type: boolean
          description: Whether the user account is approved for access
        blocked:
          type: boolean
          description: Whether the user account is blocked
        created_at:
          type: string
          format: date-time
          description: Timestamp when the user was created
        last_login:
          type: string
          format: date-time
          description: Timestamp of user's last login
        state:
          type: string
          description: Current state of the user account (e.g., active, pending)

    CreateUserRequest:
      type: object
      description: Payload for creating a new user account
      required:
        - email
        - name
      properties:
        email:
          type: string
          format: email
          description: User's email address (must be unique)
        name:
          type: string
          description: User's display name
        password:
          type: string
          description: Initial password for the account
        admin:
          type: boolean
          description: Grant administrator privileges
        approved:
          type: boolean
          description: Pre-approve the account for access
        blocked:
          type: boolean
          description: Create account in blocked state

    UpdateUserRequest:
      type: object
      description: Payload for updating user account fields
      properties:
        email:
          type: string
          format: email
          description: New email address
        name:
          type: string
          description: New display name
        password:
          type: string
          description: New password
        admin:
          type: boolean
          description: Update administrator privileges
        approved:
          type: boolean
          description: Update approval status
        blocked:
          type: boolean
          description: Update blocked status

    AccessToken:
      type: object
      description: API access token for authentication
      properties:
        id:
          type: string
          description: Unique token identifier
        description:
          type: string
          description: User-provided description for the token
        created_at:
          type: string
          format: date-time
          description: Timestamp when the token was created
        plain_token:
          type: string
          description: The actual token value (only returned on creation)

    CreateAccessTokenRequest:
      type: object
      description: Payload for creating a new access token
      required:
        - description
      properties:
        description:
          type: string
          description: Description to identify the token's purpose

    Group:
      type: object
      description: User group for organizing users and permissions
      properties:
        id:
          type: integer
          description: Unique group identifier
        name:
          type: string
          description: Group name
        description:
          type: string
          description: Optional group description

    CreateGroupRequest:
      type: object
      description: Payload for creating a new user group
      required:
        - name
      properties:
        name:
          type: string
          description: Group name (must be unique)
        description:
          type: string
          description: Optional description

    AddUserToGroupRequest:
      type: object
      description: Payload for adding a user to a group
      required:
        - id
      properties:
        id:
          type: integer
          description: User ID to add to the group

    GroupMember:
      type: object
      description: User information when listed as a group member
      properties:
        id:
          type: integer
          description: User ID
        name:
          type: string
          description: User's display name
        email:
          type: string
          description: User's email address
        admin:
          type: boolean
          description: Whether the user is an administrator
        approved:
          type: boolean
          description: Whether the user is approved
        blocked:
          type: boolean
          description: Whether the user is blocked
        created_at:
          type: string
          description: User creation timestamp
        last_login:
          type: string
          description: Last login timestamp
        state:
          type: string
          description: Account state

    Canvas:
      type: object
      description: Canvas resource containing widgets and content
      properties:
        id:
          type: string
          description: Unique canvas identifier
        name:
          type: string
          description: Canvas name
        access:
          type: string
          description: User's access level (owner, editor, viewer)
        asset_size:
          type: integer
          format: int64
          description: Total size of assets in bytes
        created_at:
          type: string
          format: date-time
          description: Canvas creation timestamp
        folder_id:
          type: string
          description: ID of the parent folder
        in_trash:
          type: boolean
          description: Whether the canvas is in trash
        mode:
          type: string
          enum: [normal, demo]
          description: Canvas mode (normal or demo)
        modified_at:
          type: string
          format: date-time
          description: Last modification timestamp
        preview_hash:
          type: string
          description: Hash for the canvas preview image
        state:
          type: string
          description: Canvas state (e.g., active, archived)

    CreateCanvasRequest:
      type: object
      description: Payload for creating a new canvas
      properties:
        name:
          type: string
          description: Canvas name
        folder_id:
          type: string
          description: Parent folder ID (optional)

    UpdateCanvasRequest:
      type: object
      description: Payload for updating canvas properties
      properties:
        name:
          type: string
          description: New canvas name
        mode:
          type: string
          enum: [normal, demo]
          description: Canvas mode

    MoveOrCopyCanvasRequest:
      type: object
      description: Payload for moving or copying a canvas
      required:
        - folder_id
      properties:
        folder_id:
          type: string
          description: Target folder ID
        conflicts:
          type: string
          enum: [rename, overwrite, skip]
          description: How to handle name conflicts

    CanvasBackground:
      type: object
      description: Canvas background settings
      properties:
        type:
          type: string
          enum: [solid, haze, image]
          description: Background type
        background_color:
          type: string
          description: Solid background color (hex format)
        haze:
          $ref: '#/components/schemas/HazeSettings'
        grid:
          $ref: '#/components/schemas/GridSettings'
        image:
          $ref: '#/components/schemas/BackgroundImage'

    HazeSettings:
      type: object
      description: Animated haze background settings
      properties:
        color1:
          type: string
          description: First haze color (hex format)
        color2:
          type: string
          description: Second haze color (hex format)
        speed:
          type: number
          description: Animation speed
        scale:
          type: number
          description: Haze pattern scale

    GridSettings:
      type: object
      description: Grid overlay settings
      properties:
        visible:
          type: boolean
          description: Whether grid is visible
        color:
          type: string
          description: Grid line color (hex format)

    BackgroundImage:
      type: object
      description: Background image settings
      properties:
        hash:
          type: string
          description: Asset hash of the background image
        fit:
          type: string
          description: Image fit mode (cover, contain, etc.)

    CanvasPermissions:
      type: object
      description: Permission overrides for a canvas
      properties:
        editors_can_share:
          type: boolean
          description: Whether editors can share the canvas
        users:
          type: array
          items:
            $ref: '#/components/schemas/CanvasUserPermission'
          description: User-specific permissions
        groups:
          type: array
          items:
            $ref: '#/components/schemas/CanvasGroupPermission'
          description: Group-specific permissions
        link_permission:
          type: string
          description: Permission level for link sharing

    CanvasUserPermission:
      type: object
      description: User permission entry for a canvas
      properties:
        id:
          type: integer
          format: int64
          description: User ID
        permission:
          type: string
          description: Permission level (owner, editor, viewer, none)
        inherited:
          type: boolean
          description: Whether permission is inherited from parent folder

    CanvasGroupPermission:
      type: object
      description: Group permission entry for a canvas
      properties:
        id:
          type: integer
          format: int64
          description: Group ID
        permission:
          type: string
          description: Permission level (owner, editor, viewer, none)
        inherited:
          type: boolean
          description: Whether permission is inherited from parent folder

    ColorPreset:
      type: object
      description: Named color preset for canvas elements
      properties:
        name:
          type: string
          description: Preset name

    ColorPresets:
      type: object
      description: Collection of color presets for different element types
      properties:
        annotation:
          type: array
          items:
            type: string
          description: Colors for annotations
        connector:
          type: array
          items:
            type: string
          description: Colors for connectors
        note_background:
          type: array
          items:
            type: string
          description: Colors for note backgrounds
        note_text:
          type: array
          items:
            type: string
          description: Colors for note text

    Folder:
      type: object
      description: Folder for organizing canvases
      properties:
        id:
          type: string
          description: Unique folder identifier
        name:
          type: string
          description: Folder name
        folder_id:
          type: string
          description: Parent folder ID (empty for root folders)
        access:
          type: string
          description: User's access level
        in_trash:
          type: boolean
          description: Whether the folder is in trash
        state:
          type: string
          description: Folder state

    CreateFolderRequest:
      type: object
      description: Payload for creating a new folder
      properties:
        name:
          type: string
          description: Folder name
        folder_id:
          type: string
          description: Parent folder ID (optional)

    RenameFolderRequest:
      type: object
      description: Payload for renaming a folder
      required:
        - name
      properties:
        name:
          type: string
          description: New folder name

    MoveOrCopyFolderRequest:
      type: object
      description: Payload for moving or copying a folder
      required:
        - folder_id
      properties:
        folder_id:
          type: string
          description: Target parent folder ID
        conflicts:
          type: string
          description: How to handle name conflicts

    FolderPermissions:
      type: object
      description: Permission overrides for a folder
      properties:
        editors_can_share:
          type: boolean
          description: Whether editors can share items in this folder
        users:
          type: array
          items:
            $ref: '#/components/schemas/FolderUserPermission'
          description: User-specific permissions
        groups:
          type: array
          items:
            $ref: '#/components/schemas/FolderGroupPermission'
          description: Group-specific permissions

    FolderUserPermission:
      type: object
      description: User permission entry for a folder
      properties:
        id:
          type: integer
          format: int64
          description: User ID
        permission:
          type: string
          description: Permission level
        inherited:
          type: boolean
          description: Whether permission is inherited

    FolderGroupPermission:
      type: object
      description: Group permission entry for a folder
      properties:
        id:
          type: integer
          format: int64
          description: Group ID
        permission:
          type: string
          description: Permission level
        inherited:
          type: boolean
          description: Whether permission is inherited

    Widget:
      type: object
      description: Generic widget on a canvas
      properties:
        id:
          type: string
          description: Unique widget identifier
        widget_type:
          type: string
          description: Widget type (note, image, pdf, video, anchor, connector, etc.)
        parent_id:
          type: string
          description: Parent widget ID for nested widgets
        location:
          $ref: '#/components/schemas/Point'
        size:
          $ref: '#/components/schemas/Size'
        pinned:
          type: boolean
          description: Whether the widget is pinned in place
        scale:
          type: number
          description: Widget scale factor (default 1.0)
        state:
          type: string
          description: Widget state (e.g., active)
        depth:
          type: integer
          description: Z-order depth for layering

    Note:
      type: object
      description: Note widget for text content
      properties:
        id:
          type: string
          description: Widget ID
        text:
          type: string
          description: Note text content
        title:
          type: string
          description: Note title
        background_color:
          type: string
          description: Background color (hex format)
        depth:
          type: integer
          description: Z-order depth
        location:
          $ref: '#/components/schemas/Point'
        parent_id:
          type: string
          description: Parent widget ID
        pinned:
          type: boolean
          description: Whether pinned
        scale:
          type: number
          description: Scale factor
        size:
          $ref: '#/components/schemas/Size'
        state:
          type: string
          description: Widget state
        widget_type:
          type: string
          description: Always "note"

    CreateNoteRequest:
      type: object
      description: Payload for creating a note widget
      properties:
        widget_type:
          type: string
          enum: [note]
          description: Must be "note"
        text:
          type: string
          description: Note text content
        title:
          type: string
          description: Note title
        background_color:
          type: string
          description: Background color (hex format)
        location:
          $ref: '#/components/schemas/Point'
        size:
          $ref: '#/components/schemas/Size'
        pinned:
          type: boolean
          description: Whether to pin the note
        scale:
          type: number
          description: Initial scale factor

    Asset:
      type: object
      description: Generic asset metadata returned from upload operations
      properties:
        id:
          type: string
          description: Asset ID
        hash:
          type: string
          description: Asset hash for content-addressable storage
        filename:
          type: string
          description: Original filename
        content_type:
          type: string
          description: MIME type of the asset
        size:
          type: integer
          description: File size in bytes
        created_at:
          type: string
          format: date-time
          description: When the asset was created

    Image:
      type: object
      description: Image widget
      properties:
        id:
          type: string
          description: Widget ID
        hash:
          type: string
          description: Asset hash of the image file
        title:
          type: string
          description: Image title
        original_filename:
          type: string
          description: Original filename when uploaded
        parent_id:
          type: string
          description: Parent widget ID
        pinned:
          type: boolean
          description: Whether pinned
        scale:
          type: number
          description: Scale factor
        size:
          $ref: '#/components/schemas/Size'
        location:
          $ref: '#/components/schemas/Point'
        state:
          type: string
          description: Widget state
        widget_type:
          type: string
          description: Always "image"
        depth:
          type: integer
          description: Z-order depth

    PDF:
      type: object
      description: PDF document widget
      properties:
        id:
          type: string
          description: Widget ID
        name:
          type: string
          description: PDF name

    Video:
      type: object
      description: Video widget
      properties:
        id:
          type: string
          description: Widget ID
        name:
          type: string
          description: Video name

    Anchor:
      type: object
      description: Anchor widget for navigation
      properties:
        id:
          type: string
          description: Widget ID
        anchor_index:
          type: integer
          description: Index for ordering anchors
        anchor_name:
          type: string
          description: Display name for the anchor
        parent_id:
          type: string
          description: Parent widget ID
        pinned:
          type: boolean
          description: Whether pinned
        scale:
          type: number
          description: Scale factor
        size:
          $ref: '#/components/schemas/Size'
        location:
          $ref: '#/components/schemas/Point'
        state:
          type: string
          description: Widget state
        widget_type:
          type: string
          description: Always "anchor"
        depth:
          type: integer
          description: Z-order depth

    CreateAnchorRequest:
      type: object
      description: Payload for creating an anchor widget
      properties:
        widget_type:
          type: string
          enum: [anchor]
          description: Must be "anchor"
        anchor_name:
          type: string
          description: Display name for the anchor
        anchor_index:
          type: integer
          description: Index for ordering
        location:
          $ref: '#/components/schemas/Point'
        size:
          $ref: '#/components/schemas/Size'

    Browser:
      type: object
      description: Browser widget for displaying web content
      required:
        - id
        - widget_type
        - url
      properties:
        id:
          type: string
          description: Widget ID
        widget_type:
          type: string
          enum: [browser]
          description: Always "browser"
        depth:
          type: number
          format: double
          description: Z-order depth
        location:
          $ref: '#/components/schemas/Point'
        main_frame_scroll_offset:
          $ref: '#/components/schemas/Point'
        parent_id:
          type: string
          description: Parent widget ID
        pinned:
          type: boolean
          description: Whether pinned
        scale:
          type: number
          format: double
          description: Browser zoom scale
        size:
          $ref: '#/components/schemas/Size'
        state:
          type: string
          description: Widget state
        title:
          type: string
          description: Browser window title
        transparent_mode:
          type: boolean
          description: Whether to use transparent mode
        url:
          type: string
          description: The URL loaded in the browser

    Connector:
      type: object
      description: Connector widget linking two widgets
      properties:
        id:
          type: string
          description: Widget ID
        src:
          $ref: '#/components/schemas/ConnectorEnd'
        dst:
          $ref: '#/components/schemas/ConnectorEnd'
        line_color:
          type: string
          description: Line color (hex format)
        line_width:
          type: integer
          description: Line width in pixels
        state:
          type: string
          description: Widget state
        type:
          type: string
          description: Connector type (straight, curved, etc.)
        widget_type:
          type: string
          description: Always "connector"

    ConnectorEnd:
      type: object
      description: Endpoint of a connector
      properties:
        auto_location:
          type: boolean
          description: Whether to auto-calculate attachment point
        id:
          type: string
          description: ID of the connected widget
        rel_location:
          $ref: '#/components/schemas/Point'
        tip:
          type: string
          description: Arrow tip style (none, arrow, etc.)

    CreateConnectorRequest:
      type: object
      description: Payload for creating a connector widget
      properties:
        widget_type:
          type: string
          enum: [connector]
          description: Must be "connector"
        src:
          type: object
          properties:
            id:
              type: string
              description: Source widget ID
        dst:
          type: object
          properties:
            id:
              type: string
              description: Destination widget ID
        line_color:
          type: string
          description: Line color (hex format)
        line_width:
          type: integer
          description: Line width in pixels
        type:
          type: string
          description: Connector type

    VideoInput:
      type: object
      description: Video input widget
      properties:
        id:
          type: string
          description: Widget ID

    VideoInputSource:
      type: object
      description: Video input source for a client
      properties:
        id:
          type: string
          description: Source ID
        name:
          type: string
          description: Source name

    VideoOutput:
      type: object
      description: Video output channel
      properties:
        index:
          type: integer
          description: Output index
        label:
          type: string
          description: Output label
        source:
          type: string
          description: Current source
        suspended:
          type: boolean
          description: Whether output is suspended
        id:
          type: string
          description: Output ID
        name:
          type: string
          description: Output name
        resolution:
          $ref: '#/components/schemas/Size'
        state:
          type: string
          description: Output state
        widget_type:
          type: string
          description: Widget type

    ClientInfo:
      type: object
      description: Client device information
      properties:
        id:
          type: string
          description: Client ID
        name:
          type: string
          description: Client name
        user_id:
          type: string
          description: Owner user ID
        created_at:
          type: string
          format: date-time
          description: Creation timestamp

    CreateClientRequest:
      type: object
      description: Payload for creating a client device
      properties:
        name:
          type: string
          description: Client name
        user_id:
          type: string
          description: Owner user ID

    UpdateClientRequest:
      type: object
      description: Payload for updating client device
      properties:
        name:
          type: string
          description: New client name

    Workspace:
      type: object
      description: Client workspace information
      required:
        - canvas_id
        - index
        - info_panel_visible
        - pinned
        - server_id
        - state
        - user
        - workspace_name
        - workspace_state
      properties:
        canvas_id:
          type: string
          description: ID of the canvas currently open in this workspace
        canvas_size:
          $ref: '#/components/schemas/Size'
        index:
          type: integer
          description: Workspace index (0-based)
        info_panel_visible:
          type: boolean
          description: Whether the info panel is visible
        location:
          $ref: '#/components/schemas/Point'
        pinned:
          type: boolean
          description: Whether the workspace is pinned
        server_id:
          type: string
          description: Server ID
        size:
          $ref: '#/components/schemas/Size'
        state:
          type: string
          description: Workspace state
        user:
          type: string
          description: User email associated with workspace
        view_rectangle:
          $ref: '#/components/schemas/Rectangle'
        workspace_name:
          type: string
          description: Workspace name
        workspace_state:
          type: string
          description: Workspace state indicator

    UpdateWorkspaceRequest:
      type: object
      description: Payload for updating workspace parameters
      properties:
        info_panel_visible:
          type: boolean
          description: Set info panel visibility
        pinned:
          type: boolean
          description: Set pinned state
        view_rectangle:
          $ref: '#/components/schemas/Rectangle'

    OpenCanvasRequest:
      type: object
      description: Payload for opening a canvas on a workspace
      required:
        - canvas_id
      properties:
        canvas_id:
          type: string
          description: ID of the canvas to open
        server_id:
          type: string
          description: Optional server ID if opening canvas from remote server
        user_email:
          type: string
          description: Optional user email for authentication
        center_x:
          type: number
          format: double
          description: Optional X coordinate to center viewport
        center_y:
          type: number
          format: double
          description: Optional Y coordinate to center viewport
        widget_id:
          type: string
          description: Optional widget ID to center viewport on

    Size:
      type: object
      description: Width and height dimensions
      required:
        - width
        - height
      properties:
        width:
          type: number
          format: double
          description: Width
        height:
          type: number
          format: double
          description: Height

    Point:
      type: object
      description: X and Y coordinates
      required:
        - x
        - y
      properties:
        x:
          type: number
          format: double
          description: X coordinate
        y:
          type: number
          format: double
          description: Y coordinate

    Rectangle:
      type: object
      description: Rectangular region defined by position and dimensions
      required:
        - x
        - y
        - width
        - height
      properties:
        x:
          type: number
          format: double
          description: X coordinate of top-left corner
        y:
          type: number
          format: double
          description: Y coordinate of top-left corner
        width:
          type: number
          format: double
          description: Width
        height:
          type: number
          format: double
          description: Height

    ServerInfo:
      type: object
      description: Canvus Server information
      properties:
        api:
          type: array
          items:
            type: string
          description: Supported API versions
        go:
          type: string
          description: Go version used to build server
        server_id:
          type: string
          description: Unique server identifier
        version:
          type: string
          description: Server version

    LicenseInfo:
      type: object
      description: License information
      properties:
        key:
          type: string
          description: License key
        valid:
          type: boolean
          description: Whether license is valid
        expires_at:
          type: string
          format: date-time
          description: License expiration date
        type:
          type: string
          description: License type (trial, standard, enterprise)
        seats:
          type: integer
          description: Number of licensed seats
        issued_to:
          type: string
          description: Licensee name
        issued_by:
          type: string
          description: Issuer name
        features:
          type: array
          items:
            type: string
          description: Enabled feature flags

    ServerConfig:
      type: object
      description: Server configuration settings
      properties:
        access:
          type: string
          description: Access configuration
        authentication:
          $ref: '#/components/schemas/AuthenticationConfig'
        email:
          $ref: '#/components/schemas/EmailConfig'
        external_url:
          type: string
          description: External URL for the server
        server_name:
          type: string
          description: Server display name

    AuthenticationConfig:
      type: object
      description: Authentication settings
      properties:
        domain_allow_list:
          type: array
          items:
            type: string
          description: Allowed email domains for sign-up
        password:
          $ref: '#/components/schemas/PasswordConfig'
        qr_code:
          $ref: '#/components/schemas/QRCodeConfig'
        require_admin_approval:
          type: boolean
          description: Whether new accounts require admin approval
        saml:
          $ref: '#/components/schemas/SAMLConfig'

    PasswordConfig:
      type: object
      description: Password authentication settings
      properties:
        enabled:
          type: boolean
          description: Whether password auth is enabled
        sign_up_enabled:
          type: boolean
          description: Whether password sign-up is enabled

    QRCodeConfig:
      type: object
      description: QR code authentication settings
      properties:
        enabled:
          type: boolean
          description: Whether QR code auth is enabled

    SAMLConfig:
      type: object
      description: SAML SSO settings
      properties:
        acs_url:
          type: string
          description: Assertion Consumer Service URL
        enabled:
          type: boolean
          description: Whether SAML is enabled
        idp_cert_finger_print:
          type: string
          description: IdP certificate fingerprint
        idp_entity_id:
          type: string
          description: IdP entity ID
        idp_target_url:
          type: string
          description: IdP target URL
        name_id_format:
          type: string
          description: Name ID format
        sign_up_enabled:
          type: boolean
          description: Whether SAML sign-up is enabled
        sp_entity_id:
          type: string
          description: Service Provider entity ID

    EmailConfig:
      type: object
      description: Email server settings
      properties:
        mail_reply_to_address:
          type: string
          description: Reply-to email address
        mail_reply_to_name:
          type: string
          description: Reply-to display name
        mail_sender_address:
          type: string
          description: Sender email address
        mail_sender_name:
          type: string
          description: Sender display name
        smtp_allow_self_signed_certificates:
          type: boolean
          description: Allow self-signed TLS certificates
        smtp_host:
          type: string
          description: SMTP server hostname
        smtp_password:
          type: string
          description: SMTP password
        smtp_port:
          type: integer
          description: SMTP server port
        smtp_security:
          type: string
          description: Security mode (none, starttls, tls)
        smtp_username:
          type: string
          description: SMTP username

    AuditEvent:
      type: object
      description: Audit log event
      properties:
        id:
          type: string
          description: Event ID
        timestamp:
          type: string
          format: date-time
          description: Event timestamp
        user_id:
          type: integer
          format: int64
          description: User who performed the action
        action:
          type: string
          description: Action performed (login, create, update, delete, etc.)
        resource:
          type: string
          description: Resource type affected
        details:
          type: string
          description: Additional event details

    MipmapInfo:
      type: object
      description: Mipmap information for an asset
      properties:
        resolution:
          type: object
          properties:
            width:
              type: integer
              description: Original image width
            height:
              type: integer
              description: Original image height
        max_level:
          type: integer
          description: Maximum mipmap level available
        pages:
          type: integer
          description: Number of pages (for PDFs)
